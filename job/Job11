#!/bin/bash

NEW_INVENTORY="inventory.txt"
CURRENT_INVENTORY="current_inventory.txt"
REPORT="inventory_report.txt"

if [[ ! -f "$NEW_INVENTORY" || ! -f "$CURRENT_INVENTORY" ]]; then
  echo "Erreur : Assurez-vous que $NEW_INVENTORY et $CURRENT_INVENTORY existent."
  exit 1
fi

cp "$CURRENT_INVENTORY" temp_inventory.txt

while IFS=',' read -r title qty price; do
  if grep -q "^$title," temp_inventory.txt; then
    sed -i "s/^$title,.*/$title,$qty,$price/" temp_inventory.txt
  else
    echo "$title,$qty,$price" >> temp_inventory.txt
  fi
done < "$NEW_INVENTORY"

sort temp_inventory.txt > "$REPORT"

mv temp_inventory.txt "$CURRENT_INVENTORY"

echo "✅ Rapport généré : $REPORT"
echo "✅ Inventaire mis à jour : $CURRENT_INVENTORY"